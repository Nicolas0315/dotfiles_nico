prefix_rule(pattern=["C:\\Program Files\\PowerShell\\7\\pwsh.exe", "-Command", "gh issue list --state open"], decision="allow")
prefix_rule(pattern=["C:\\Program Files\\PowerShell\\7\\pwsh.exe", "-Command", "gh issue view 33"], decision="allow")
prefix_rule(pattern=["C:\\Program Files\\PowerShell\\7\\pwsh.exe", "-Command", "@'\nimport re\nfrom pathlib import Path\n\npath = Path(r\"C:\\Users\\ogosh\\Desktop\\eiai\\video-analysis\\docs\\issues\\ISSUES_TIMELINE.md\")\ntext = path.read_text(encoding=\"utf-8\")\n\ndate = \"2026-01-09\"\ntext = re.sub(r\"\\*\\*最終更新\\*\\*: .*\", f\"**最終更新**: {date} (UTC)\", text)\ntext = re.sub(r\"\\*\\*圧縮更新\\*\\*: .*\", f\"**圧縮更新**: {date}\", text)\n\npattern = r\"^\\| #33 \\|([^|]+)\\|([^|]+)\\|([^|]+)\\|([^|]+)\\|([^|]+)\\|\\s*$\"\n\ndef repl(match):\n    title = match.group(1).strip()\n    priority = match.group(2).strip()\n    due = match.group(4).strip()\n    owner = match.group(5).strip()\n    return f\"| #33 | {title} | {priority} | {date} | {due} | {owner} |\"\n\ntext, count = re.subn(pattern, repl, text, flags=re.M)\nif count != 1:\n    raise SystemExit(f\"Expected to update 1 row for #33, updated {count}\")\n\npath.write_text(text, encoding=\"utf-8\")\n'@ | python -"], decision="allow")
prefix_rule(pattern=["C:\\Program Files\\PowerShell\\7\\pwsh.exe", "-Command", "$ErrorActionPreference = \"Stop\"\n$root = \"C:\\Users\\ogosh\\Desktop\\eiai\\video-analysis\"\n$log = Join-Path $root \"cors_check_uvicorn.log\"\nRemove-Item $log -ErrorAction SilentlyContinue\n\n$env:ENVIRONMENT = \"production\"\n$env:CORS_ORIGINS = \"http://localhost:3000\"\n$env:GEMINI_API_KEY = \"dummy\"\n$env:SECRET_KEY = \"local-test-secret\"\n$env:DEBUG = \"false\"\n\n$proc = Start-Process -FilePath \"python\" -ArgumentList \"-m\",\"uvicorn\",\"api.main:app\",\"--host\",\"127.0.0.1\",\"--port\",\"8000\" -WorkingDirectory $root -RedirectStandardOutput $log -RedirectStandardError $log -PassThru\nStart-Sleep -Seconds 3\nif ($proc.HasExited) {\n  \"Uvicorn failed to start. Log:\"\n  Get-Content $log\n  exit 1\n}\n\n$ready = $false\nfor ($i = 0; $i -lt 10; $i++) {\n  try {\n    $code = curl.exe -s -o $null -w \"%{http_code}\" \"http://localhost:8000/api/health\"\n    if ($code -ne \"000\") { $ready = $true; break }\n  } catch {}\n  Start-Sleep -Seconds 1\n}\nif (-not $ready) {\n  \"Uvicorn did not become ready.\"\n}\n\n\"=== Preflight ===\"\ncurl.exe -i -X OPTIONS \"http://localhost:8000/api/health\" `\n  -H \"Origin: http://localhost:3000\" `\n  -H \"Access-Control-Request-Method: GET\" `\n  -H \"Access-Control-Request-Headers: content-type\"\n\n\"=== Actual ===\"\ncurl.exe -i \"http://localhost:8000/api/health\" -H \"Origin: http://localhost:3000\"\n\nStop-Process -Id $proc.Id -Force\n"], decision="allow")
prefix_rule(pattern=["C:\\Program Files\\PowerShell\\7\\pwsh.exe", "-Command", "$ErrorActionPreference = \"Stop\"\n$root = \"C:\\Users\\ogosh\\Desktop\\eiai\\video-analysis\"\n$logOut = Join-Path $root \"cors_check_uvicorn.out.log\"\n$logErr = Join-Path $root \"cors_check_uvicorn.err.log\"\nRemove-Item $logOut, $logErr -ErrorAction SilentlyContinue\n\n$env:ENVIRONMENT = \"production\"\n$env:CORS_ORIGINS = \"http://localhost:3000\"\n$env:GEMINI_API_KEY = \"dummy\"\n$env:SECRET_KEY = \"local-test-secret\"\n$env:DEBUG = \"false\"\n\n$proc = Start-Process -FilePath \"python\" -ArgumentList \"-m\",\"uvicorn\",\"api.main:app\",\"--host\",\"127.0.0.1\",\"--port\",\"8000\" -WorkingDirectory $root -RedirectStandardOutput $logOut -RedirectStandardError $logErr -PassThru\nStart-Sleep -Seconds 3\nif ($proc.HasExited) {\n  \"Uvicorn failed to start. stdout:\"\n  if (Test-Path $logOut) { Get-Content $logOut }\n  \"stderr:\"\n  if (Test-Path $logErr) { Get-Content $logErr }\n  exit 1\n}\n\n$ready = $false\nfor ($i = 0; $i -lt 10; $i++) {\n  try {\n    $code = curl.exe -s -o $null -w \"%{http_code}\" \"http://localhost:8000/api/health\"\n    if ($code -ne \"000\") { $ready = $true; break }\n  } catch {}\n  Start-Sleep -Seconds 1\n}\nif (-not $ready) {\n  \"Uvicorn did not become ready.\"\n}\n\n\"=== Preflight ===\"\ncurl.exe -i -X OPTIONS \"http://localhost:8000/api/health\" `\n  -H \"Origin: http://localhost:3000\" `\n  -H \"Access-Control-Request-Method: GET\" `\n  -H \"Access-Control-Request-Headers: content-type\"\n\n\"=== Actual ===\"\ncurl.exe -i \"http://localhost:8000/api/health\" -H \"Origin: http://localhost:3000\"\n\nStop-Process -Id $proc.Id -Force\n"], decision="allow")
prefix_rule(pattern=["C:\\Program Files\\PowerShell\\7\\pwsh.exe", "-Command", "Stop-Process -Id 65480 -Force"], decision="allow")
prefix_rule(pattern=["C:\\Program Files\\PowerShell\\7\\pwsh.exe", "-Command", "$ErrorActionPreference = \"Stop\"\n$root = \"C:\\Users\\ogosh\\Desktop\\eiai\\video-analysis\"\n$logOut = Join-Path $root \"cors_check_uvicorn.out.log\"\n$logErr = Join-Path $root \"cors_check_uvicorn.err.log\"\nRemove-Item $logOut, $logErr -ErrorAction SilentlyContinue\n\n$env:ENVIRONMENT = \"production\"\n$env:CORS_ORIGINS = \"http://localhost:3000\"\n$env:GEMINI_API_KEY = \"dummy\"\n$env:SECRET_KEY = \"local-test-secret\"\n$env:DEBUG = \"false\"\n\n$proc = Start-Process -FilePath \"python\" -ArgumentList \"-m\",\"uvicorn\",\"api.main:app\",\"--host\",\"127.0.0.1\",\"--port\",\"8000\" -WorkingDirectory $root -RedirectStandardOutput $logOut -RedirectStandardError $logErr -PassThru\ntry {\n  Start-Sleep -Seconds 2\n  if ($proc.HasExited) {\n    \"Uvicorn failed to start. stdout:\"\n    if (Test-Path $logOut) { Get-Content $logOut }\n    \"stderr:\"\n    if (Test-Path $logErr) { Get-Content $logErr }\n    exit 1\n  }\n\n  $ready = $false\n  for ($i = 0; $i -lt 120; $i++) {\n    try {\n      $code = curl.exe -s -o $null -w \"%{http_code}\" \"http://localhost:8000/api/health\"\n      if ($code -ne \"000\") { $ready = $true; break }\n    } catch {}\n    Start-Sleep -Seconds 1\n  }\n\n  if (-not $ready) {\n    \"Uvicorn did not become ready within 120s. stdout:\"\n    if (Test-Path $logOut) { Get-Content $logOut }\n    \"stderr:\"\n    if (Test-Path $logErr) { Get-Content $logErr }\n    exit 1\n  }\n\n  \"=== Preflight ===\"\n  curl.exe -i -X OPTIONS \"http://localhost:8000/api/health\" `\n    -H \"Origin: http://localhost:3000\" `\n    -H \"Access-Control-Request-Method: GET\" `\n    -H \"Access-Control-Request-Headers: content-type\"\n\n  \"=== Actual ===\"\n  curl.exe -i \"http://localhost:8000/api/health\" -H \"Origin: http://localhost:3000\"\n}\nfinally {\n  if ($proc -and -not $proc.HasExited) {\n    Stop-Process -Id $proc.Id -Force\n  }\n}\n"], decision="allow")
prefix_rule(pattern=["C:\\Program Files\\PowerShell\\7\\pwsh.exe", "-Command", "$ErrorActionPreference = \"Stop\"\n$root = \"C:\\Users\\ogosh\\Desktop\\eiai\\video-analysis\"\n$logOut = Join-Path $root \"cors_check_uvicorn.out.log\"\n$logErr = Join-Path $root \"cors_check_uvicorn.err.log\"\nRemove-Item $logOut, $logErr -ErrorAction SilentlyContinue\n\n$env:ENVIRONMENT = \"production\"\n$env:CORS_ORIGINS = \"http://localhost:3000\"\n$env:GEMINI_API_KEY = \"dummy\"\n$env:SECRET_KEY = \"local-test-secret\"\n$env:DEBUG = \"false\"\n\n$proc = Start-Process -FilePath \"python\" -ArgumentList \"-m\",\"uvicorn\",\"api.main:app\",\"--host\",\"127.0.0.1\",\"--port\",\"8000\" -WorkingDirectory $root -RedirectStandardOutput $logOut -RedirectStandardError $logErr -PassThru\ntry {\n  Start-Sleep -Seconds 2\n  $ready = $false\n  for ($i = 0; $i -lt 120; $i++) {\n    if ($proc.HasExited) {\n      \"Uvicorn exited early. stdout:\"\n      if (Test-Path $logOut) { Get-Content $logOut }\n      \"stderr:\"\n      if (Test-Path $logErr) { Get-Content $logErr }\n      exit 1\n    }\n\n    $code = curl.exe -s -o $null -w \"%{http_code}\" \"http://localhost:8000/api/health\" 2>$null\n    if ($code) {\n      $trim = $code.Trim()\n      if ($trim -match '^\\d{3}$' -and $trim -ne \"000\") {\n        $ready = $true\n        break\n      }\n    }\n    Start-Sleep -Seconds 1\n  }\n\n  if (-not $ready) {\n    \"Uvicorn did not become ready within 120s. stdout:\"\n    if (Test-Path $logOut) { Get-Content $logOut }\n    \"stderr:\"\n    if (Test-Path $logErr) { Get-Content $logErr }\n    exit 1\n  }\n\n  \"=== Preflight ===\"\n  curl.exe -i -X OPTIONS \"http://localhost:8000/api/health\" `\n    -H \"Origin: http://localhost:3000\" `\n    -H \"Access-Control-Request-Method: GET\" `\n    -H \"Access-Control-Request-Headers: content-type\"\n\n  \"=== Actual ===\"\n  curl.exe -i \"http://localhost:8000/api/health\" -H \"Origin: http://localhost:3000\"\n}\nfinally {\n  if ($proc -and -not $proc.HasExited) {\n    Stop-Process -Id $proc.Id -Force\n  }\n}\n"], decision="allow")
prefix_rule(pattern=["C:\\Program Files\\PowerShell\\7\\pwsh.exe", "-Command", "Stop-Process -Id 139436 -Force"], decision="allow")
prefix_rule(pattern=["C:\\Program Files\\PowerShell\\7\\pwsh.exe", "-Command", "$ErrorActionPreference = \"Stop\"\n$root = \"C:\\Users\\ogosh\\Desktop\\eiai\\video-analysis\"\n$logOut = Join-Path $root \"cors_check_uvicorn.out.log\"\n$logErr = Join-Path $root \"cors_check_uvicorn.err.log\"\nRemove-Item $logOut, $logErr -ErrorAction SilentlyContinue\n\n$env:ENVIRONMENT = \"production\"\n$env:CORS_ORIGINS = \"http://localhost:3000\"\n$env:GEMINI_API_KEY = \"dummy\"\n$env:SECRET_KEY = \"local-test-secret\"\n$env:DEBUG = \"false\"\n\n$proc = Start-Process -FilePath \"python\" -ArgumentList \"-m\",\"uvicorn\",\"api.main:app\",\"--host\",\"127.0.0.1\",\"--port\",\"8000\" -WorkingDirectory $root -RedirectStandardOutput $logOut -RedirectStandardError $logErr -PassThru\ntry {\n  Start-Sleep -Seconds 10\n  $ready = $false\n  for ($i = 0; $i -lt 60; $i++) {\n    if ($proc.HasExited) {\n      \"Uvicorn exited early. stdout:\"\n      if (Test-Path $logOut) { Get-Content $logOut }\n      \"stderr:\"\n      if (Test-Path $logErr) { Get-Content $logErr }\n      exit 1\n    }\n\n    $code = curl.exe -s --connect-timeout 1 --max-time 2 -o $null -w \"%{http_code}\" \"http://localhost:8000/api/health\" 2>$null\n    if ($code) {\n      $trim = $code.Trim()\n      if ($trim -match '^\\d{3}$' -and $trim -ne \"000\") {\n        $ready = $true\n        break\n      }\n    }\n    Start-Sleep -Seconds 1\n  }\n\n  if (-not $ready) {\n    \"Uvicorn did not become ready within ~70s. stdout:\"\n    if (Test-Path $logOut) { Get-Content $logOut }\n    \"stderr:\"\n    if (Test-Path $logErr) { Get-Content $logErr }\n    exit 1\n  }\n\n  $preflight = curl.exe -s --connect-timeout 2 --max-time 10 -D - -o $null -X OPTIONS \"http://localhost:8000/api/health\" `\n    -H \"Origin: http://localhost:3000\" `\n    -H \"Access-Control-Request-Method: GET\" `\n    -H \"Access-Control-Request-Headers: content-type\"\n\n  $actual = curl.exe -s --connect-timeout 2 --max-time 10 -D - -o $null \"http://localhost:8000/api/health\" `\n    -H \"Origin: http://localhost:3000\"\n\n  \"=== Preflight Headers ===\"\n  $preflight -split \"`r?`n\" | Where-Object { $_ -match '^(HTTP/|access-control)' }\n  \"=== Actual Headers ===\"\n  $actual -split \"`r?`n\" | Where-Object { $_ -match '^(HTTP/|access-control)' }\n}\nfinally {\n  if ($proc -and -not $proc.HasExited) {\n    Stop-Process -Id $proc.Id -Force\n  }\n}\n"], decision="allow")
prefix_rule(pattern=["C:\\Program Files\\PowerShell\\7\\pwsh.exe", "-Command", "$ErrorActionPreference = \"Stop\"\n$root = \"C:\\Users\\ogosh\\Desktop\\eiai\\video-analysis\"\n$logOut = Join-Path $root \"cors_check_uvicorn.out.log\"\n$logErr = Join-Path $root \"cors_check_uvicorn.err.log\"\nRemove-Item $logOut, $logErr -ErrorAction SilentlyContinue\n\n$env:ENVIRONMENT = \"production\"\n$env:CORS_ORIGINS = \"http://localhost:3000\"\n$env:GEMINI_API_KEY = \"dummy\"\n$env:SECRET_KEY = \"local-test-secret\"\n$env:DEBUG = \"false\"\n\n$proc = Start-Process -FilePath \"python\" -ArgumentList \"-m\",\"uvicorn\",\"api.main:app\",\"--host\",\"127.0.0.1\",\"--port\",\"8000\" -WorkingDirectory $root -RedirectStandardOutput $logOut -RedirectStandardError $logErr -PassThru\ntry {\n  Start-Sleep -Seconds 5\n  $ready = $false\n  for ($i = 0; $i -lt 60; $i++) {\n    if ($proc.HasExited) {\n      \"Uvicorn exited early. stdout:\"\n      if (Test-Path $logOut) { Get-Content $logOut }\n      \"stderr:\"\n      if (Test-Path $logErr) { Get-Content $logErr }\n      exit 1\n    }\n\n    try {\n      $resp = Invoke-WebRequest -Method Get -Uri \"http://localhost:8000/api/health\" -TimeoutSec 5 -UseBasicParsing\n      if ($resp.StatusCode -ge 200 -and $resp.StatusCode -lt 500) {\n        $ready = $true\n        break\n      }\n    } catch {}\n\n    Start-Sleep -Seconds 1\n  }\n\n  if (-not $ready) {\n    \"Uvicorn did not become ready within ~65s. stdout:\"\n    if (Test-Path $logOut) { Get-Content $logOut }\n    \"stderr:\"\n    if (Test-Path $logErr) { Get-Content $logErr }\n    exit 1\n  }\n\n  try {\n    $preflight = Invoke-WebRequest -Method Options -Uri \"http://localhost:8000/api/health\" -TimeoutSec 10 -UseBasicParsing -Headers @{\n      Origin = \"http://localhost:3000\"\n      \"Access-Control-Request-Method\" = \"GET\"\n      \"Access-Control-Request-Headers\" = \"content-type\"\n    }\n  } catch {\n    \"Preflight request failed: $($_.Exception.Message)\"\n    throw\n  }\n\n  try {\n    $actual = Invoke-WebRequest -Method Get -Uri \"http://localhost:8000/api/health\" -TimeoutSec 10 -UseBasicParsing -Headers @{\n      Origin = \"http://localhost:3000\"\n    }\n  } catch {\n    \"Actual request failed: $($_.Exception.Message)\"\n    throw\n  }\n\n  \"=== Preflight ===\"\n  \"HTTP $($preflight.StatusCode)\"\n  $preflight.Headers.GetEnumerator() | Where-Object { $_.Key -match '^Access-Control' } | ForEach-Object { \"{0}: {1}\" -f $_.Key, $_.Value }\n\n  \"=== Actual ===\"\n  \"HTTP $($actual.StatusCode)\"\n  $actual.Headers.GetEnumerator() | Where-Object { $_.Key -match '^Access-Control' } | ForEach-Object { \"{0}: {1}\" -f $_.Key, $_.Value }\n}\nfinally {\n  if ($proc -and -not $proc.HasExited) {\n    Stop-Process -Id $proc.Id -Force\n  }\n}\n"], decision="allow")
prefix_rule(pattern=["C:\\Program Files\\PowerShell\\7\\pwsh.exe", "-Command", "$ErrorActionPreference = \"Stop\"\n$root = \"C:\\Users\\ogosh\\Desktop\\eiai\\video-analysis\"\n$logOut = Join-Path $root \"cors_check_uvicorn.out.log\"\n$logErr = Join-Path $root \"cors_check_uvicorn.err.log\"\nRemove-Item $logOut, $logErr -ErrorAction SilentlyContinue\n\n$env:ENVIRONMENT = \"production\"\n$env:CORS_ORIGINS = \"http://localhost:3000\"\n$env:GEMINI_API_KEY = \"dummy\"\n$env:SECRET_KEY = \"local-test-secret\"\n$env:DEBUG = \"false\"\n\n$proc = Start-Process -FilePath \"python\" -ArgumentList \"-m\",\"uvicorn\",\"api.main:app\",\"--host\",\"127.0.0.1\",\"--port\",\"8000\" -WorkingDirectory $root -RedirectStandardOutput $logOut -RedirectStandardError $logErr -PassThru\ntry {\n  Start-Sleep -Seconds 5\n  $ready = $false\n  for ($i = 0; $i -lt 60; $i++) {\n    if ($proc.HasExited) {\n      \"Uvicorn exited early. stdout:\"\n      if (Test-Path $logOut) { Get-Content $logOut }\n      \"stderr:\"\n      if (Test-Path $logErr) { Get-Content $logErr }\n      exit 1\n    }\n\n    try {\n      $resp = Invoke-WebRequest -Method Get -Uri \"http://localhost:8000/api/health\" -TimeoutSec 5 -UseBasicParsing\n      if ($resp.StatusCode -ge 200 -and $resp.StatusCode -lt 500) {\n        $ready = $true\n        break\n      }\n    } catch {}\n\n    Start-Sleep -Seconds 1\n  }\n\n  if (-not $ready) {\n    \"Uvicorn did not become ready within ~65s. stdout:\"\n    if (Test-Path $logOut) { Get-Content $logOut }\n    \"stderr:\"\n    if (Test-Path $logErr) { Get-Content $logErr }\n    exit 1\n  }\n\n  $preflight = Invoke-WebRequest -Method Options -Uri \"http://localhost:8000/api/health\" -TimeoutSec 10 -UseBasicParsing -Headers @{\n    Origin = \"http://localhost:3000\"\n    \"Access-Control-Request-Method\" = \"GET\"\n    \"Access-Control-Request-Headers\" = \"content-type\"\n  }\n\n  $actual = Invoke-WebRequest -Method Get -Uri \"http://localhost:8000/api/health\" -TimeoutSec 10 -UseBasicParsing -Headers @{\n    Origin = \"http://localhost:3000\"\n  }\n\n  function Format-Headers($headers) {\n    $headers.GetEnumerator() |\n      Where-Object { $_.Key -match '^Access-Control' } |\n      ForEach-Object {\n        $val = $_.Value\n        if ($val -is [string[]]) { $val = ($val -join \", \") }\n        \"{0}: {1}\" -f $_.Key, $val\n      }\n  }\n\n  \"=== Preflight ===\"\n  \"HTTP $($preflight.StatusCode)\"\n  Format-Headers $preflight.Headers\n\n  \"=== Actual ===\"\n  \"HTTP $($actual.StatusCode)\"\n  Format-Headers $actual.Headers\n}\nfinally {\n  if ($proc -and -not $proc.HasExited) {\n    Stop-Process -Id $proc.Id -Force\n  }\n}\n"], decision="allow")
prefix_rule(pattern=["C:\\Program Files\\PowerShell\\7\\pwsh.exe", "-Command", "@'\nfrom pathlib import Path\n\npath = Path(r\"C:\\Users\\ogosh\\Desktop\\eiai\\video-analysis\\docs\\issues\\ISSUES_TIMELINE.md\")\ntext = path.read_text(encoding=\"utf-8\")\nlines = text.splitlines(True)\n\nneedle = \"2026-01-08: Issueラベル整理（カテゴリ/領域）\"\ninsert_line = \"- 2026-01-11: #33 CORS検証完了（localhost:3000 -> localhost:8000）\"\n\n# Avoid duplicate insert\nif any(insert_line in line for line in lines):\n    raise SystemExit(\"Insert line already exists\")\n\nfor i, line in enumerate(lines):\n    if needle in line:\n        newline = \"\\n\"\n        if line.endswith(\"\\r\\n\"):\n            newline = \"\\r\\n\"\n        lines.insert(i + 1, insert_line + newline)\n        break\nelse:\n    raise SystemExit(\"Needle not found\")\n\npath.write_text(\"\".join(lines), encoding=\"utf-8\")\n'@ | python -"], decision="allow")
prefix_rule(pattern=["C:\\Program Files\\PowerShell\\7\\pwsh.exe", "-Command", "gh issue close 33 --comment \"ローカル想定でCORS検証を実施（api/main.py / ENVIRONMENT=production / CORS_ORIGINS=http://localhost:3000）。OPTIONS/GETともにAccess-Control-Allow-Origin/Allow-Credentialsを確認。詳細はdocs/issues/ISSUES_TIMELINE.mdに追記。\""], decision="allow")
prefix_rule(pattern=["C:\\Program Files\\PowerShell\\7\\pwsh.exe", "-Command", "python scripts/ralph_loop.py --prompt-file prompts/ralph_loop_example.md --completion-promise \"<promise>COMPLETE</promise>\" --max-iterations 10 --command goose run --task \"{prompt}\""], decision="allow")
prefix_rule(pattern=["C:\\Program Files\\PowerShell\\7\\pwsh.exe", "-Command", "@'\nimport re\nfrom pathlib import Path\n\npath = Path(r\"C:\\Users\\ogosh\\Desktop\\eiai\\video-analysis\\docs\\issues\\ISSUES_TIMELINE.md\")\ntext = path.read_text(encoding=\"utf-8\")\n\npattern = r\"^\\| #33 \\|([^|]+)\\|([^|]+)\\|([^|]+)\\|([^|]+)\\|([^|]+)\\|\\s*$\"\n\ndef repl(match):\n    title = match.group(1).strip()\n    priority = match.group(2).strip()\n    started = match.group(3).strip()\n    owner = match.group(5).strip()\n    return f\"| #33 | {title} | {priority} | {started} | 2026-01-11 | {owner} |\"\n\nnew_text, count = re.subn(pattern, repl, text, flags=re.M)\nif count != 1:\n    raise SystemExit(f\"Expected to update 1 row for #33, updated {count}\")\n\npath.write_text(new_text, encoding=\"utf-8\")\n'@ | python -"], decision="allow")
prefix_rule(pattern=["C:\\Program Files\\PowerShell\\7\\pwsh.exe", "-Command", "Remove-Item -Force \"C:\\Users\\ogosh\\Desktop\\eiai\\video-analysis\\cors_check_uvicorn.out.log\",\"C:\\Users\\ogosh\\Desktop\\eiai\\video-analysis\\cors_check_uvicorn.err.log\""], decision="allow")
prefix_rule(pattern=["C:\\Program Files\\PowerShell\\7\\pwsh.exe", "-Command", "gh release view --repo block/goose --json tagName,assets"], decision="allow")
prefix_rule(pattern=["C:\\Program Files\\PowerShell\\7\\pwsh.exe", "-Command", "$dest = \"C:\\Users\\ogosh\\Desktop\\eiai\\video-analysis\\tools\\goose\"; New-Item -ItemType Directory -Force -Path $dest | Out-Null; gh release download v1.19.1 --repo block/goose --pattern \"goose-x86_64-pc-windows-gnu.zip\" --dir $dest; $zip = Join-Path $dest \"goose-x86_64-pc-windows-gnu.zip\"; Expand-Archive -Path $zip -DestinationPath $dest -Force; Get-ChildItem -Path $dest -Recurse -Filter \"goose.exe\" | Select-Object -First 1 -ExpandProperty FullName"], decision="allow")
prefix_rule(pattern=["C:\\Program Files\\PowerShell\\7\\pwsh.exe", "-Command", "python scripts/ralph_loop.py --prompt-file prompts/ralph_loop_example.md --completion-promise \"<promise>COMPLETE</promise>\" --max-iterations 10 --halt-on-command-error --command C:\\Users\\ogosh\\Desktop\\eiai\\video-analysis\\tools\\goose\\goose-package\\goose.exe run --task \"{prompt}\""], decision="allow")
prefix_rule(pattern=["C:\\Program Files\\PowerShell\\7\\pwsh.exe", "-Command", "gh pr list --state open"], decision="allow")
prefix_rule(pattern=["C:\\Program Files\\PowerShell\\7\\pwsh.exe", "-Command", "& \"C:\\Users\\ogosh\\Desktop\\eiai\\video-analysis\\tools\\goose\\goose-package\\goose.exe\" run --help"], decision="allow")
prefix_rule(pattern=["C:\\Program Files\\PowerShell\\7\\pwsh.exe", "-Command", "gh pr list --state merged --limit 20"], decision="allow")
prefix_rule(pattern=["C:\\Program Files\\PowerShell\\7\\pwsh.exe", "-Command", "python scripts/ralph_loop.py --prompt-file prompts/ralph_loop_example.md --completion-promise \"<promise>COMPLETE</promise>\" --max-iterations 10 --halt-on-command-error --command C:\\Users\\ogosh\\Desktop\\eiai\\video-analysis\\tools\\goose\\goose-package\\goose.exe run --text \"{prompt}\""], decision="allow")
prefix_rule(pattern=["C:\\Program Files\\PowerShell\\7\\pwsh.exe", "-Command", "gh issue list --state all --limit 50"], decision="allow")
prefix_rule(pattern=["C:\\Program Files\\PowerShell\\7\\pwsh.exe", "-Command", "@'\nimport re\nfrom pathlib import Path\n\npath = Path(r\"C:\\Users\\ogosh\\Desktop\\eiai\\video-analysis\\docs\\issues\\ISSUES_TIMELINE.md\")\ntext = path.read_text(encoding=\"utf-8\")\n\nreplacements = {\n    32: {\"priority\": \"完了\", \"due\": \"2026-01-08\"},\n    34: {\"priority\": \"完了\", \"due\": \"2026-01-12\"},\n    35: {\"priority\": \"完了\", \"due\": \"2026-01-12\"},\n}\n\nfor issue, data in replacements.items():\n    pattern = rf\"^\\| #{issue} \\|([^|]+)\\|([^|]+)\\|([^|]+)\\|([^|]+)\\|([^|]+)\\|\\s*$\"\n    def repl(match):\n        title = match.group(1).strip()\n        started = match.group(3).strip()\n        owner = match.group(5).strip()\n        return f\"| #{issue} | {title} | {data['priority']} | {started} | {data['due']} | {owner} |\"\n    new_text, count = re.subn(pattern, repl, text, flags=re.M)\n    if count != 1:\n        raise SystemExit(f\"Expected to update 1 row for #{issue}, updated {count}\")\n    text = new_text\n\npath.write_text(text, encoding=\"utf-8\")\n'@ | python -"], decision="allow")
prefix_rule(pattern=["C:\\Program Files\\PowerShell\\7\\pwsh.exe", "-Command", "@'\nimport re\nfrom pathlib import Path\n\npath = Path(r\"C:\\Users\\ogosh\\Desktop\\eiai\\video-analysis\\docs\\issues\\ISSUES_TIMELINE.md\")\ntext = path.read_text(encoding=\"utf-8\")\n\npattern = r\"^\\| #35 \\|([^|]+)\\|([^|]+)\\|([^|]+)\\|([^|]+)\\|([^|]+)\\|\\s*$\"\n\ndef repl(match):\n    title = match.group(1).strip()\n    priority = match.group(2).strip()\n    started = match.group(3).strip()\n    due = match.group(4).strip()\n    return f\"| #35 | {title} | {priority} | {started} | {due} | 未設定 |\"\n\nnew_text, count = re.subn(pattern, repl, text, flags=re.M)\nif count != 1:\n    raise SystemExit(f\"Expected to update 1 row for #35, updated {count}\")\n\npath.write_text(new_text, encoding=\"utf-8\")\n'@ | python -"], decision="allow")
prefix_rule(pattern=["C:\\Program Files\\PowerShell\\7\\pwsh.exe", "-Command", "git add \"docs/issues/ISSUES_TIMELINE.md\""], decision="allow")
prefix_rule(pattern=["C:\\Program Files\\PowerShell\\7\\pwsh.exe", "-Command", "$dest = \"C:\\Users\\ogosh\\Desktop\\eiai\\video-analysis\\prompts\\ralph_loop_example.goose\"; Get-Content -LiteralPath \"C:\\Users\\ogosh\\Desktop\\eiai\\video-analysis\\prompts\\ralph_loop_example.md\" | Set-Content -LiteralPath $dest -Encoding UTF8"], decision="allow")
prefix_rule(pattern=["C:\\Program Files\\PowerShell\\7\\pwsh.exe", "-Command", "git commit -m \"docs: sync issues timeline with GitHub status\""], decision="allow")
prefix_rule(pattern=["C:\\Program Files\\PowerShell\\7\\pwsh.exe", "-Command", "git push"], decision="allow")
prefix_rule(pattern=["C:\\Program Files\\PowerShell\\7\\pwsh.exe", "-Command", "& \"C:\\Users\\ogosh\\Desktop\\eiai\\video-analysis\\tools\\goose\\goose-package\\goose.exe\" configure"], decision="allow")
prefix_rule(pattern=["C:\\Program Files\\PowerShell\\7\\pwsh.exe", "-Command", "@'\nfrom pathlib import Path\n\npath = Path(r\"C:\\Users\\ogosh\\Desktop\\eiai\\video-analysis\\docs\\project\\PROGRESS.md\")\ntext = path.read_text(encoding=\"utf-8\")\ntext = text.replace(\"**最終更新**: 2025-11-19\", \"**最終更新**: 2026-01-12\")\ntext = text.replace(\"**圧縮更新**: 2026-01-07\", \"**圧縮更新**: 2026-01-12\")\ntext = text.replace(\"**進捗率**: **約85%** ?\", \"**進捗率**: **約85%（暫定）**\")\n\nmarker = \"- RESTful API設計\"\ninsert = \"- 進行中/残タスクは `docs/issues/ISSUES_TIMELINE.md` と `docs/planning/TODO.md` を参照\"\nif insert not in text:\n    text = text.replace(marker, marker + \"\\n\" + insert)\n\npath.write_text(text, encoding=\"utf-8\")\n'@ | python -"], decision="allow")
prefix_rule(pattern=["C:\\Program Files\\PowerShell\\7\\pwsh.exe", "-Command", "@'\nimport re\nfrom pathlib import Path\n\npath = Path(r\"C:\\Users\\ogosh\\Desktop\\eiai\\video-analysis\\docs\\project\\PROGRESS.md\")\ntext = path.read_text(encoding=\"utf-8\")\ntext, count = re.subn(r\"\\*\\*進捗率\\*\\*: \\*\\*約85%\\*\\*\\s*\\?\", \"**進捗率**: **約85%（暫定）**\", text)\nif count != 1:\n    raise SystemExit(f\"Progress line replace count: {count}\")\npath.write_text(text, encoding=\"utf-8\")\n'@ | python -"], decision="allow")
prefix_rule(pattern=["C:\\Program Files\\PowerShell\\7\\pwsh.exe", "-Command", "$env:PYTHONIOENCODING='utf-8'; @'\nfrom pathlib import Path\nimport re\n\npath = Path(r\"C:\\Users\\ogosh\\Desktop\\eiai\\video-analysis\\docs\\project\\PROGRESS.md\")\ntext = path.read_text(encoding=\"utf-8\")\ntext, count = re.subn(r\"\\*\\*進捗率\\*\\*:[^\\n]*\", \"**進捗率**: **約85%（暫定）**\", text)\nif count != 1:\n    raise SystemExit(f\"Progress line replace count: {count}\")\npath.write_text(text, encoding=\"utf-8\")\n'@ | python -"], decision="allow")
prefix_rule(pattern=["C:\\Program Files\\PowerShell\\7\\pwsh.exe", "-Command", "@'\nfrom pathlib import Path\n\npath = Path(r\"C:\\Users\\ogosh\\Desktop\\eiai\\video-analysis\\docs\\planning\\ROADMAP.md\")\ntext = path.read_text(encoding=\"utf-8\")\ntext = text.replace(\"最終更新: 2025年6月3日\", \"最終更新: 2026年01月12日\")\ntext = text.replace(\"**圧縮更新**: 2026-01-07\", \"**圧縮更新**: 2026-01-12\")\n\ninsert = \"- 現在の優先タスクは `docs/planning/TODO.md` と `docs/issues/ISSUES_TIMELINE.md` を参照\"\nif insert not in text:\n    marker = \"- ?? **Low**: 将来的な実装（必要時）\"\n    text = text.replace(marker, marker + \"\\n\" + insert)\n\npath.write_text(text, encoding=\"utf-8\")\n'@ | python -"], decision="allow")
prefix_rule(pattern=["C:\\Program Files\\PowerShell\\7\\pwsh.exe", "-Command", "python scripts/ralph_loop.py --prompt-file prompts/ralph_loop_example.goose --completion-promise \"<promise>COMPLETE</promise>\" --max-iterations 10 --halt-on-command-error --command C:\\Users\\ogosh\\Desktop\\eiai\\video-analysis\\tools\\goose\\goose-package\\goose.exe run --provider gemini-cli --model gemini-1.5-flash --instructions {prompt_file}"], decision="allow")
prefix_rule(pattern=["C:\\Program Files\\PowerShell\\7\\pwsh.exe", "-Command", "@'\nimport re\nfrom pathlib import Path\n\npath = Path(r\"C:\\Users\\ogosh\\Desktop\\eiai\\video-analysis\\docs\\planning\\ROADMAP.md\")\ntext = path.read_text(encoding=\"utf-8\")\ninsert = \"- 現在の優先タスクは `docs/planning/TODO.md` と `docs/issues/ISSUES_TIMELINE.md` を参照\"\n\nif insert not in text:\n    def repl(match):\n        return match.group(0) + \"\\n\" + insert\n    text, count = re.subn(r\"(^- .*\\*\\*Low\\*\\*.*)$\", repl, text, flags=re.M)\n    if count == 0:\n        raise SystemExit(\"Low priority line not found for insert\")\n\npath.write_text(text, encoding=\"utf-8\")\n'@ | python -"], decision="allow")
prefix_rule(pattern=["C:\\Program Files\\PowerShell\\7\\pwsh.exe", "-Command", "@'\nfrom pathlib import Path\nimport re\n\npath = Path(r\"C:\\Users\\ogosh\\Desktop\\eiai\\video-analysis\\docs\\planning\\TODO.md\")\ntext = path.read_text(encoding=\"utf-8\")\ninsert = \"- 進行中のIssueは `docs/issues/ISSUES_TIMELINE.md` を一次情報とする\"\n\nif insert not in text:\n    # Insert after the first major point block line (TikTok動画バッチ分析準備)\n    pattern = r\"(^- \\*\\*TikTok動画バッチ分析準備\\*\\*.*$)\"\n    def repl(match):\n        return match.group(1) + \"\\n\" + insert\n    text, count = re.subn(pattern, repl, text, flags=re.M)\n    if count == 0:\n        raise SystemExit(\"Failed to insert alignment note in TODO\")\n\npath.write_text(text, encoding=\"utf-8\")\n'@ | python -"], decision="allow")
prefix_rule(pattern=["C:\\Program Files\\PowerShell\\7\\pwsh.exe", "-Command", "git add \"docs/project/PROGRESS.md\" \"docs/planning/ROADMAP.md\" \"docs/planning/TODO.md\""], decision="allow")
prefix_rule(pattern=["C:\\Program Files\\PowerShell\\7\\pwsh.exe", "-Command", "python scripts/ralph_loop.py --prompt-file prompts/ralph_loop_example.goose --completion-promise \"<promise>COMPLETE</promise>\" --max-iterations 10 --halt-on-command-error --command C:\\Users\\ogosh\\Desktop\\eiai\\video-analysis\\tools\\goose\\goose-package\\goose.exe run --provider gemini-cli --model gemini-1.5-flash --instructions '{prompt_file}'"], decision="allow")
prefix_rule(pattern=["C:\\Program Files\\PowerShell\\7\\pwsh.exe", "-Command", "git commit -m \"docs: align progress and roadmap with issues\""], decision="allow")
prefix_rule(pattern=["C:\\Program Files\\PowerShell\\7\\pwsh.exe", "-Command", "npm view @google/gemini-cli name version"], decision="allow")
prefix_rule(pattern=["C:\\Program Files\\PowerShell\\7\\pwsh.exe", "-Command", "gh issue comment 37 --body \"Issue #37対応として、圧縮版ドキュメントの整合を実施。\\n\\n更新内容:\\n- docs/project/PROGRESS.md: 更新日を最新化し、進行中/残タスクの参照先を明記\\n- docs/planning/ROADMAP.md: 更新日を最新化し、優先タスクの参照先を追記\\n- docs/planning/TODO.md: Issue一次情報の参照先を追記\\n\\nコミット: e3bb123（docs: align progress and roadmap with issues）\""], decision="allow")
prefix_rule(pattern=["C:\\Program Files\\PowerShell\\7\\pwsh.exe", "-Command", "gh issue close 37"], decision="allow")
prefix_rule(pattern=["C:\\Program Files\\PowerShell\\7\\pwsh.exe", "-Command", "npm install -g @google/gemini-cli"], decision="allow")
prefix_rule(pattern=["C:\\Program Files\\PowerShell\\7\\pwsh.exe", "-Command", "@'\nimport re\nfrom pathlib import Path\n\npath = Path(r\"C:\\Users\\ogosh\\Desktop\\eiai\\video-analysis\\docs\\issues\\ISSUES_TIMELINE.md\")\ntext = path.read_text(encoding=\"utf-8\")\n\npattern = r\"^\\| #37 \\|([^|]+)\\|([^|]+)\\|([^|]+)\\|([^|]+)\\|([^|]+)\\|\\s*$\"\n\ndef repl(match):\n    title = match.group(1).strip()\n    started = match.group(3).strip()\n    owner = match.group(5).strip()\n    return f\"| #37 | {title} | 完了 | {started} | 2026-01-12 | {owner} |\"\n\nnew_text, count = re.subn(pattern, repl, text, flags=re.M)\nif count != 1:\n    raise SystemExit(f\"Expected to update 1 row for #37, updated {count}\")\n\npath.write_text(new_text, encoding=\"utf-8\")\n'@ | python -"], decision="allow")
prefix_rule(pattern=["C:\\Program Files\\PowerShell\\7\\pwsh.exe", "-Command", "git commit -m \"docs: mark issue 37 as completed\""], decision="allow")
prefix_rule(pattern=["C:\\Program Files\\PowerShell\\7\\pwsh.exe", "-Command", "& \"$env:APPDATA\\npm\\gemini.cmd\" --version"], decision="allow")
prefix_rule(pattern=["C:\\Program Files\\PowerShell\\7\\pwsh.exe", "-Command", "Get-ChildItem -LiteralPath \"$env:APPDATA\\npm\" -Filter \"gemini*\" | Select-Object Name"], decision="allow")
prefix_rule(pattern=["C:\\Program Files\\PowerShell\\7\\pwsh.exe", "-Command", "Get-Content -LiteralPath \"$env:APPDATA\\npm\\gemini\" -TotalCount 5"], decision="allow")
prefix_rule(pattern=["C:\\Program Files\\PowerShell\\7\\pwsh.exe", "-Command", "gh search code \"GEMINI_CLI_COMMAND\" --repo block/goose --limit 5"], decision="allow")
prefix_rule(pattern=["C:\\Program Files\\PowerShell\\7\\pwsh.exe", "-Command", "gh api repos/block/goose/contents/documentation/docs/guides/cli-providers.md"], decision="allow")
prefix_rule(pattern=["C:\\Program Files\\PowerShell\\7\\pwsh.exe", "-Command", "$b = (gh api repos/block/goose/contents/documentation/docs/guides/cli-providers.md).content; $text = [System.Text.Encoding]::UTF8.GetString([System.Convert]::FromBase64String($b)); $text | Select-String -Pattern \"GEMINI_CLI_COMMAND|Gemini CLI\" -Context 0,3"], decision="allow")
prefix_rule(pattern=["C:\\Program Files\\PowerShell\\7\\pwsh.exe", "-Command", "$b = (gh api repos/block/goose/contents/documentation/docs/guides/cli-providers.md).content; $text = [System.Text.Encoding]::UTF8.GetString([System.Convert]::FromBase64String($b)); $text | Select-String -Pattern \"Gemini CLI Configuration\" -Context 0,8"], decision="allow")
prefix_rule(pattern=["C:\\Program Files\\PowerShell\\7\\pwsh.exe", "-Command", "$b = (gh api repos/block/goose/contents/documentation/docs/guides/cli-providers.md).content; $text = [System.Text.Encoding]::UTF8.GetString([System.Convert]::FromBase64String($b)); $text.Split(\"`n\")[0..20]"], decision="allow")
prefix_rule(pattern=["C:\\Program Files\\PowerShell\\7\\pwsh.exe", "-Command", "$url = \"https://raw.githubusercontent.com/block/goose/main/documentation/docs/guides/cli-providers.md\"; $text = (Invoke-WebRequest -Uri $url -UseBasicParsing).Content; $text | Select-String -Pattern \"Gemini CLI\" -Context 0,6"], decision="allow")
prefix_rule(pattern=["C:\\Program Files\\PowerShell\\7\\pwsh.exe", "-Command", "@'\nimport subprocess\ncmd = r\"C:\\Users\\ogosh\\AppData\\Roaming\\npm\\gemini.cmd\"\ntry:\n    result = subprocess.run([cmd, \"--version\"], capture_output=True, text=True)\n    print(\"returncode:\", result.returncode)\n    print(\"stdout:\", result.stdout)\n    print(\"stderr:\", result.stderr)\nexcept Exception as e:\n    print(\"error:\", e)\n'@ | python -"], decision="allow")
prefix_rule(pattern=["C:\\Program Files\\PowerShell\\7\\pwsh.exe", "-Command", "git add -- \"dashboard/next.config.js\" \"dashboard/src/app/page.tsx\" \"dashboard/src/app/videos/[id]/page.tsx\" \"dashboard/src/components/FiveSceneAnalysis.tsx\" \"dashboard/src/components/UGCCreativeSummary.tsx\" \"dashboard/src/contexts/AuthContext.tsx\"; git commit -m \"fix: ダッシュボードの取得処理と画像表示を調整\""], decision="allow")
prefix_rule(pattern=["C:\\Program Files\\PowerShell\\7\\pwsh.exe", "-Command", "gh api repos/block/goose/contents/crates/goose/src/providers/gemini_cli.rs"], decision="allow")
prefix_rule(pattern=["C:\\Program Files\\PowerShell\\7\\pwsh.exe", "-Command", "git add -- \"config/secure_settings.py\" \"src/video_analysis/analysis/advanced_analysis.py\" \"src/video_analysis/analysis/audio_features.py\" \"standalone_ugc_analyzer.py\" \"utils/goose_integration.py\" \"README.md\"; git commit -m \"feat: スタンドアロン分析と音声処理を改善\""], decision="allow")
prefix_rule(pattern=["C:\\Program Files\\PowerShell\\7\\pwsh.exe", "-Command", "$url = \"https://raw.githubusercontent.com/block/goose/main/crates/goose/src/providers/gemini_cli.rs\"; $text = (Invoke-WebRequest -Uri $url -UseBasicParsing).Content; $text | Select-String -Pattern \"Command::new|GEMINI_CLI_COMMAND|GEMINI_CLI_COMMAND\" -Context 0,3"], decision="allow")
prefix_rule(pattern=["C:\\Program Files\\PowerShell\\7\\pwsh.exe", "-Command", "git add -- \"AGENTS.md\" \".skills/agent-browser/SKILL.md\" \".skills/vibium/SKILL.md\" \"scripts/setup_mcp.ps1\" \"scripts/setup_mcp.sh\" \"package.json\" \"requirements.txt\"; git commit -m \"feat: ブラウザ自動化スキルとMCP設定を追加\""], decision="allow")
prefix_rule(pattern=["C:\\Program Files\\PowerShell\\7\\pwsh.exe", "-Command", "git add -- \"scripts/ralph_loop.py\" \"docs/ai/RALPH_LOOP.md\" \"docs/ai/AGENTS.md\" \"prompts/ralph_loop_example.md\" \"prompts/ralph_loop_example.goose\"; git commit -m \"feat: ralph loop 反復実行を追加\""], decision="allow")
prefix_rule(pattern=["C:\\Program Files\\PowerShell\\7\\pwsh.exe", "-Command", "Get-Command csc -ErrorAction SilentlyContinue | Select-Object -ExpandProperty Source"], decision="allow")
prefix_rule(pattern=["C:\\Program Files\\PowerShell\\7\\pwsh.exe", "-Command", "git add -- \"scripts/obsidian_chat_sync.py\" \"tools/goose/goose-package/libwinpthread-1.dll\" \"tools/goose/goose-package/libstdc++-6.dll\" \"tools/goose/goose-package/libgcc_s_seh-1.dll\"; git commit -m \"chore: obsidian同期とgoose依存を追加\""], decision="allow")
prefix_rule(pattern=["C:\\Program Files\\PowerShell\\7\\pwsh.exe", "-Command", "dotnet --version"], decision="allow")
prefix_rule(pattern=["C:\\Program Files\\PowerShell\\7\\pwsh.exe", "-Command", "Get-ChildItem -LiteralPath \"$env:APPDATA\\npm\\node_modules\\@google\\gemini-cli\" -Recurse -Filter \"*.exe\" | Select-Object -First 5 -ExpandProperty FullName"], decision="allow")
prefix_rule(pattern=["C:\\Program Files\\PowerShell\\7\\pwsh.exe", "-Command", "git add -- \"api/services/video_service.py\"; git commit -m \"fix: サムネイル生成の初期化を補正\""], decision="allow")
prefix_rule(pattern=["C:\\Program Files\\PowerShell\\7\\pwsh.exe", "-Command", "$url = \"https://raw.githubusercontent.com/block/goose/main/crates/goose/src/subprocess.rs\"; $text = (Invoke-WebRequest -Uri $url -UseBasicParsing).Content; $text | Select-String -Pattern \"configure_command_no_window\" -Context 0,6"], decision="allow")
prefix_rule(pattern=["C:\\Program Files\\PowerShell\\7\\pwsh.exe", "-Command", "gh search code \"Gemini\" --repo block/goose --path crates/goose/src/providers --limit 20"], decision="allow")
prefix_rule(pattern=["C:\\Program Files\\PowerShell\\7\\pwsh.exe", "-Command", "git push origin refactor/module-reorganization-phase1"], decision="allow")
prefix_rule(pattern=["C:\\Program Files\\PowerShell\\7\\pwsh.exe", "-Command", "gh search code \"gemini\" --repo block/goose --limit 20"], decision="allow")
prefix_rule(pattern=["C:\\Program Files\\PowerShell\\7\\pwsh.exe", "-Command", "@'\nimport subprocess\ncmd = r\"C:\\Users\\ogosh\\AppData\\Roaming\\npm\\gemini.cmd\"\ntry:\n    result = subprocess.run([cmd, \"--version\"], capture_output=True, text=True, creationflags=0x08000000, timeout=10)\n    print(\"returncode:\", result.returncode)\n    print(\"stdout:\", result.stdout)\n    print(\"stderr:\", result.stderr)\nexcept Exception as e:\n    print(\"error:\", e)\n'@ | python -"], decision="allow")
prefix_rule(pattern=["C:\\Program Files\\PowerShell\\7\\pwsh.exe", "-Command", "& \"$env:APPDATA\\npm\\gemini.cmd\" --help | Select-Object -First 40"], decision="allow")
prefix_rule(pattern=["C:\\Program Files\\PowerShell\\7\\pwsh.exe", "-Command", "@'\nimport subprocess\ncmd = r\"C:\\Users\\ogosh\\AppData\\Roaming\\npm\\gemini.cmd --version\"\ntry:\n    result = subprocess.run(cmd, capture_output=True, text=True, shell=True, timeout=10)\n    print(\"returncode:\", result.returncode)\n    print(\"stdout:\", result.stdout)\n    print(\"stderr:\", result.stderr)\nexcept Exception as e:\n    print(\"error:\", e)\n'@ | python -"], decision="allow")
prefix_rule(pattern=["C:\\Program Files\\PowerShell\\7\\pwsh.exe", "-Command", "@'\nimport subprocess\ncmd = r\"C:\\Users\\ogosh\\AppData\\Roaming\\npm\\gemini.ps1\"\ntry:\n    result = subprocess.run([cmd, \"--version\"], capture_output=True, text=True, timeout=5)\n    print(\"returncode:\", result.returncode)\n    print(\"stdout:\", result.stdout)\n    print(\"stderr:\", result.stderr)\nexcept Exception as e:\n    print(\"error:\", e)\n'@ | python -"], decision="allow")
prefix_rule(pattern=["C:\\Program Files\\PowerShell\\7\\pwsh.exe", "-Command", "$url = \"https://raw.githubusercontent.com/block/goose/main/documentation/docs/getting-started/providers.md\"; $text = (Invoke-WebRequest -Uri $url -UseBasicParsing).Content; $text | Select-String -Pattern \"Gemini\" -Context 0,3"], decision="allow")
prefix_rule(pattern=["C:\\Program Files\\PowerShell\\7\\pwsh.exe", "-Command", "$url = \"https://raw.githubusercontent.com/block/goose/main/crates/goose/src/providers/google.rs\"; $text = (Invoke-WebRequest -Uri $url -UseBasicParsing).Content; $text | Select-String -Pattern \"ProviderMetadata::new\\(\" -Context 0,2"], decision="allow")
prefix_rule(pattern=["C:\\Program Files\\PowerShell\\7\\pwsh.exe", "-Command", "Get-Acl -LiteralPath \"$env:APPDATA\\npm\\gemini.cmd\" | Format-List"], decision="allow")
prefix_rule(pattern=["C:\\Program Files\\PowerShell\\7\\pwsh.exe", "-Command", "$env:GEMINI_CLI_COMMAND=\"C:\\Users\\ogosh\\AppData\\Roaming\\npm\\gemini.cmd\"; $env:GOOSE_GEMINI_CLI_DEBUG=\"1\"; & \"C:\\Users\\ogosh\\Desktop\\eiai\\video-analysis\\tools\\goose\\goose-package\\goose.exe\" run --provider gemini-cli --model gemini-1.5-flash --instructions \"C:\\Users\\ogosh\\Desktop\\eiai\\video-analysis\\prompts\\ralph_loop_example.goose\""], decision="allow")
prefix_rule(pattern=["C:\\Program Files\\PowerShell\\7\\pwsh.exe", "-Command", "& \"$env:APPDATA\\npm\\gemini.cmd\" -p \"ping\" --yolo --output-format text"], decision="allow")
prefix_rule(pattern=["C:\\Program Files\\PowerShell\\7\\pwsh.exe", "-Command", "rg -n \"settings.json|GEMINI_API_KEY|auth\" \"$env:APPDATA\\npm\\node_modules\\@google\\gemini-cli\""], decision="allow")
prefix_rule(pattern=["C:\\Program Files\\PowerShell\\7\\pwsh.exe", "-Command", "rg -n \"Authentication|auth\" \"$env:APPDATA\\npm\\node_modules\\@google\\gemini-cli\\README.md\" -n"], decision="allow")
prefix_rule(pattern=["C:\\Program Files\\PowerShell\\7\\pwsh.exe", "-Command", "Get-Content -LiteralPath \"$env:APPDATA\\npm\\node_modules\\@google\\gemini-cli\\README.md\" | Select-Object -Skip 120 -First 80"], decision="allow")
prefix_rule(pattern=["C:\\Program Files\\PowerShell\\7\\pwsh.exe", "-Command", "Get-Content -LiteralPath \"$env:APPDATA\\npm\\node_modules\\@google\\gemini-cli\\docs\\get-started\\authentication.md\" | Select-Object -First 200"], decision="allow")
prefix_rule(pattern=["C:\\Program Files\\PowerShell\\7\\pwsh.exe", "-Command", "rg -n \"authentication\\.md\" \"$env:APPDATA\\npm\\node_modules\\@google\\gemini-cli\""], decision="allow")
prefix_rule(pattern=["C:\\Program Files\\PowerShell\\7\\pwsh.exe", "-Command", "Get-Content -LiteralPath \"$env:APPDATA\\npm\\node_modules\\@google\\gemini-cli\\node_modules\\@google\\gemini-cli-core\\dist\\docs\\get-started\\authentication.md\" | Select-Object -First 200"], decision="allow")
prefix_rule(pattern=["C:\\Program Files\\PowerShell\\7\\pwsh.exe", "-Command", "py -3.10 -m venv .venv-aiavatarkit; .\\.venv-aiavatarkit\\Scripts\\python -m pip install -r requirements.txt; .\\.venv-aiavatarkit\\Scripts\\python -m pip install -e .; .\\.venv-aiavatarkit\\Scripts\\python -m pip install pytest; .\\.venv-aiavatarkit\\Scripts\\python -m pytest tests\\sts\\vad\\test_standard.py -q"], decision="allow")
prefix_rule(pattern=["C:\\Program Files\\PowerShell\\7\\pwsh.exe", "-Command", "pytest tests/ -v"], decision="allow")
prefix_rule(pattern=["C:\\Program Files\\PowerShell\\7\\pwsh.exe", "-Command", ".\\.venv\\Scripts\\pytest.exe tests/ -v"], decision="allow")
prefix_rule(pattern=["C:\\Program Files\\PowerShell\\7\\pwsh.exe", "-Command", "python -m pytest tests/ -v"], decision="allow")
prefix_rule(pattern=["C:\\Program Files\\PowerShell\\7\\pwsh.exe", "-Command", ".\\.venv-aiavatarkit\\Scripts\\python -m pip install -r requirements.txt"], decision="allow")
