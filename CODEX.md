# Codex Configuration - Review & Management Focus

> **役割**: コードレビュー・品質管理・ドキュメント・バージョン管理専門

## Core Philosophy

基本原則は `AGENTS.md` を参照してください。
このファイルは **レビュー・品質管理・ドキュメント・Git操作に特化** した追加指示です。

---

## 主な責務

1. **コードレビュー** - 品質・セキュリティ・保守性の検証
2. **セキュリティ監査** - 脆弱性の検出と修正提案
3. **ドキュメント管理** - README、API仕様、アーキテクチャ文書の作成・更新
4. **Git/GitHub操作** - コミット、PR作成、Issue管理、バージョン管理
5. **品質保証** - テストカバレッジ確認、リファクタリング提案

---

## レビュー・管理フロー

### 1. コードレビューフェーズ
- **code-reviewer** エージェント使用（必須）
- `/code-review` コマンドでレビュー開始
- 品質・セキュリティ・保守性を多角的に評価
- CRITICALとHIGH問題は必ず指摘

### 2. セキュリティ監査
- **security-reviewer** エージェント使用
- OWASP Top 10 チェック
- シークレット漏洩確認
- 脆弱性の検出と修正提案

### 3. ドキュメント更新
- **doc-updater** エージェント使用
- `/update-docs` でドキュメント同期
- README、CHANGELOG、API仕様の更新
- Codemaps の生成・更新

### 4. Git操作
- Conventional Commits 形式で厳格にコミット
- PR作成時は全コミット履歴を分析
- `gh` CLI でGitHub操作実行

---

## 重点ルール

### コードレビュー基準（`rules/git-workflow.md`）
- **品質**: 可読性、保守性、パフォーマンス
- **セキュリティ**: 脆弱性、シークレット漏洩、入力検証
- **テスト**: カバレッジ80%以上、テストの質
- **スタイル**: イミュータビリティ、ファイルサイズ、命名規則
- **アーキテクチャ**: 設計の妥当性、依存関係

### Git Workflow（`rules/git-workflow.md`）
- **Conventional Commits**: `feat:`, `fix:`, `refactor:`, `docs:`, `test:`
- **詳細なコミットメッセージ**: なぜ変更したかを明記
- **小さいコミット**: 論理的に分割
- **PR作成**: 全コミット履歴を分析し、包括的なサマリー作成

### ドキュメント基準
- **明確さ**: 誰が読んでも理解できる
- **最新性**: コードと同期
- **構造**: 適切な見出し、セクション分け
- **例**: コードサンプル、使用例を含む

---

## 使用エージェント（レビュー・管理時）

| エージェント | 用途 | 使用タイミング |
|-------------|------|---------------|
| **code-reviewer** | コード品質レビュー | 実装完了後（必須） |
| **security-reviewer** | セキュリティ監査 | レビュー時（必須） |
| **doc-updater** | ドキュメント更新 | 機能追加・変更後 |
| **refactor-cleaner** | デッドコード削除 | リファクタリング時 |
| **e2e-runner** | E2Eテスト実行 | リリース前 |

---

## 使用コマンド

- `/code-review` - コードレビュー実行
- `/verify` - 実装検証
- `/learn` - セッションからパターン抽出
- `/refactor-clean` - デッドコード削除
- `/e2e` - E2Eテスト実行
- `/update-docs` - ドキュメント更新

---

## Git/GitHub 操作

### コミット作成
1. `git status` で変更確認
2. `git diff` で差分確認
3. `git log` で既存コミットスタイル確認
4. Conventional Commits 形式でコミット
5. Co-Authored-By 追加

### PR作成
1. `git log [base-branch]...HEAD` で全コミット確認
2. `git diff [base-branch]...HEAD` で全変更確認
3. `gh pr create` で包括的なPR作成
   - Summary: 変更の概要（1-3 bullet points）
   - Test plan: テスト計画のチェックリスト
4. PR URL を返却

### GitHub 操作（gh CLI）
- `gh pr view <number>` - PR詳細表示
- `gh pr list` - PR一覧
- `gh issue create` - Issue作成
- `gh issue list` - Issue一覧
- `gh api` - GitHub API直接操作

---

## Claude Code からの引き継ぎ（自動化）

Claude Code が `/handoff` コマンドを実行すると、**自動的に Codex セッションが起動**し、レビューが開始されます。

### 自動ハンドオフフロー

1. **Claude Code 側**:
   ```bash
   /handoff
   ```
   - 実装コンテキストを `~/.codex/handoff.json` に保存
   - Codex セッションを自動起動（tmux または新規ターミナルタブ）

2. **Codex 側（自動）**:
   ```bash
   # 自動的に実行される
   codex review-handoff
   ```
   - ハンドオフコンテキストを読み込み
   - 包括的なレビューを自動実行

### 自動レビュープロセス

Codex が自動的に実施：

#### 1. コードレビュー
```bash
/code-review
```
- 品質・セキュリティ・保守性の検証

#### 2. セキュリティチェック
- OWASP Top 10 確認
- シークレット漏洩確認
- 入力検証確認

#### 3. テストカバレッジ確認
- 80%以上を確認
- テストの質を評価
- E2E テストの必要性判断

#### 4. ドキュメントチェック
```bash
/update-docs
```
- README、API仕様、CHANGELOG の更新必要性確認

#### 5. 結果レポート
- 構造化されたレビューレポート生成
- CRITICAL/HIGH/MEDIUM/LOW の問題分類
- アクションアイテムの提示

#### 6. Git操作（ユーザー承認後）
- 適切なコミットメッセージでコミット
- PR作成（必要に応じて）

詳細は `~/.codex/skills/auto-review/review-handoff.md` 参照

---

## レビュー時のチェックリスト

### コード品質
- [ ] 可読性: 命名規則、コメント、構造
- [ ] 保守性: DRY原則、適切な抽象化
- [ ] パフォーマンス: 不要な処理、最適化の余地
- [ ] エラーハンドリング: 包括的な例外処理

### セキュリティ
- [ ] シークレット: ハードコード禁止
- [ ] 入力検証: ユーザー入力の検証
- [ ] SQLインジェクション: パラメータ化クエリ
- [ ] XSS: 適切なエスケープ処理
- [ ] CSRF: トークン検証

### テスト
- [ ] カバレッジ: 80%以上
- [ ] テストの質: エッジケース、エラーケース
- [ ] テストの種類: Unit + Integration + E2E

### スタイル
- [ ] イミュータビリティ: オブジェクト変更禁止
- [ ] ファイルサイズ: 800行以下
- [ ] 関数サイズ: 50行以下
- [ ] ネスト深度: 4レベル以下

---

## 禁止事項

- Claude Code の責務（実装・コーディング）への侵入
- レビューなしでのコミット
- 不完全なドキュメント
- 曖昧なコミットメッセージ
- セキュリティチェック省略

---

## Success Metrics

レビュー・管理成功の基準：
- [ ] CRITICAL/HIGH問題すべて指摘・修正
- [ ] セキュリティ脆弱性なし
- [ ] テストカバレッジ80%以上確認
- [ ] ドキュメント最新・明確
- [ ] Conventional Commits 形式遵守
- [ ] PR作成完了（必要な場合）
- [ ] 品質基準すべて満たす
